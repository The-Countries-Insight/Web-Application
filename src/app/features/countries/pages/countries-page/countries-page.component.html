<mat-toolbar color="primary" class="page-toolbar">
  <span>Country Insights</span>
  <span class="spacer"></span>

  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Search country</mat-label>
    <input
      matInput
      [value]="searchTerm()"
      (input)="onSearchChange($any($event.target).value)"
    />
    <button
      mat-icon-button
      matSuffix
      *ngIf="searchTerm()"
      (click)="clearSearch()"
      aria-label="Clear search"
    >
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>
</mat-toolbar>

<div class="page-container" *ngIf="!(loading$ | async); else loadingTpl">
  <section class="sidebar">
    <h2>Countries</h2>

    <app-country-list
      [countries]="(countries$ | async) ?? []"
      (selectCountry)="onSelectCountry($event)"
      (toggleFavorite)="onToggleFavorite($event)"
    ></app-country-list>
  </section>

  <section class="main">
    <app-country-detail></app-country-detail>

    <section class="favorites" *ngIf="(favoriteCountries$ | async)?.length">
      <h2>Favorites</h2>
      <app-country-list
        [compact]="true"
        [countries]="(favoriteCountries$ | async) ?? []"
        (selectCountry)="onSelectCountry($event)"
        (toggleFavorite)="onToggleFavorite($event)"
      ></app-country-list>
    </section>
  </section>
</div>

<ng-template #loadingTpl>
  <div class="loading-container">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
</ng-template>

<div class="error-container" *ngIf="(error$ | async) as error">
  <mat-icon>error</mat-icon>
  <span>{{ error }}</span>
</div>
